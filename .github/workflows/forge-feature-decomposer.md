---
description: "Decompose milestone feature issues into Copilot-assignable work items with clear acceptance criteria"
imports:
  - shared/forge-base.md
  - shared/forge-issue-creator.md
  - shared/forge-conventions.md
engine:
  id: copilot
  model: claude-opus-4.6
on:
  issues:
    types: [labeled]
  workflow_dispatch:
permissions:
  contents: read
  issues: read
  pull-requests: read
tools:
  github:
    toolsets: [default]
safe-outputs:
  create-issue:
    labels: ["forge-automation", "work-item", "planning"]
    title-prefix: "[Work item] "
    max: 5
    expires: 30
---

# Forge Feature Decomposer

Automatically decompose milestone feature issues into smaller, Copilot-assignable work items with clear acceptance criteria.

## IMMEDIATE EXIT CHECK

**CRITICAL: Execute this check BEFORE any file reads, API calls, or analysis.**

1. Check if the triggering issue has the `milestone-feature` label
2. If the label is NOT present, output "No milestone-feature label found. Exiting." and stop immediately
3. If the label IS present, proceed to Loop Prevention checks below

Do NOT read any files, make any GitHub API calls, or perform any analysis before completing this check.

## Loop Prevention

If the triggering issue meets any of these conditions, do nothing:
- Title starts with `[Work item]` (this workflow's output)
- Has label `forge-automation` but NOT `milestone-feature`
- Does NOT have label `milestone-feature`
- Already has open child work items (search for issues linking to this one)

## Decomposition Objectives

When a feature issue is labeled with `milestone-feature`:

1. **Analyze feature structure**:
   - Parse title and description
   - Extract acceptance criteria (checklist items)
   - Extract requirements
   - Identify priority (from labels: priority:p0-p3)
   - Identify effort level (from labels or description)
   - Determine parent milestone (if any)

2. **Decompose into work items** (3-5 items):
   - Break down feature into atomic, independently completable tasks
   - Map subset of acceptance criteria to each work item
   - Assign specific files/components to modify
   - Define clear success criteria for each work item
   - Estimate effort (small/medium/large) based on LOC and complexity
   - Identify dependencies between work items (if any)

3. **Ensure work item quality**:
   - Each work item must be Copilot-assignable (< 500 LOC, < 3 files)
   - Each must have concrete implementation scope (not vague "implement X")
   - Each must specify file paths or components to modify
   - Each must have testable acceptance criteria
   - Each must be independent or clearly state dependencies

## Work Item Structure

Each created work item should have:

**Title**: `[Work item] {specific, actionable description}`

**Body**:
```markdown
# Work Item: {Name}

**Parent Feature**: #{feature-issue-number} {feature-title}
**Milestone**: #{milestone-number} {milestone-title} _(if parent is milestoned)_

## Description
{Clear description of what this work item accomplishes}

## Scope
{What files/components will be modified}
- `path/to/file1.ext` â€” {what changes}
- `path/to/file2.ext` â€” {what changes}

## Acceptance Criteria
- [ ] {specific criterion from parent feature}
- [ ] {specific criterion from parent feature}
- [ ] {additional verification needed}

## Success Criteria
{How to verify this work item is complete}
- [ ] {test or validation step}
- [ ] {test or validation step}

## Implementation Guidance
{Technical notes, patterns to follow, considerations}

## Effort Estimate
{small|medium|large} â€” {brief reasoning}
- Estimated LOC: {< 100 | 100-300 | 300-500}
- Files modified: {1-3}
- Complexity: {low|medium|high}

## Dependencies
{List any other work items that must be completed first, or "None"}
- Depends on: #{work-item-number} _(if applicable)_

## Questions for Maintainers
{If clarification needed, tag appropriate maintainers}
- [ ] @{maintainer}: {question} _(if needed)_
```

**Labels**:
- `forge-automation`
- `work-item`
- `priority:p0` (or p1/p2/p3, inherited from parent feature)
- `effort:small` (or medium/large)
- `needs-clarification` (if questions exist)

**Milestone**:
- Assign to same milestone as parent feature (if parent is milestoned)

## Feature Issue Comment

After creating work items, add a comment to the parent feature issue:

```markdown
## ðŸ”¨ Feature Decomposed into Work Items

This feature has been decomposed into {count} work items:

1. #{work-item-1-number} â€” {brief description}
2. #{work-item-2-number} â€” {brief description}
3. #{work-item-3-number} â€” {brief description}
...

**Work Item Progress**: 0/{count} complete

### Dependency Order
{If dependencies exist, show recommended completion order}
1. Start with: #{work-item-number}
2. Then: #{work-item-number}
3. Finally: #{work-item-number}

**Next Steps**:
- Review work items for completeness
- Assign to appropriate contributors or Copilot
- Track completion in milestone #{milestone-number}

_Generated by Feature Decomposer workflow_
```

## Decomposition Strategy

### Quality Over Quantity
- Prefer 3 well-defined work items over 5 vague ones
- Each work item should represent a meaningful unit of work
- Avoid creating work items for trivial changes (< 50 LOC)

### Scope Boundaries
- **Good**: "Add input validation to `parser.js` `parseJSON()` function"
- **Bad**: "Implement validation"
- **Good**: "Update `SKILL.md` with new examples section following template"
- **Bad**: "Update documentation"

### File Path Specificity
- Always include concrete file paths when known
- Use patterns when exact files unknown: `forge-plugin/skills/*/SKILL.md`
- Reference existing files as examples when creating new ones

### Acceptance Criteria Mapping
- Map each parent acceptance criterion to at least one work item
- If criterion spans multiple work items, split logically
- Add verification steps specific to each work item

### Effort Estimation
| Estimate | LOC Range | Files | Complexity Examples |
|----------|-----------|-------|---------------------|
| **small** | < 100 | 1-2 | Add validation, update docs, fix bug |
| **medium** | 100-300 | 2-3 | Add new skill section, refactor module |
| **large** | 300-500 | 3+ | Implement new agent, major refactor |

## Constraints

- Create maximum 5 work items per feature (enforced by safe-outputs)
- Each work item must be atomic and independently completable
- Preserve parent feature intent; do not invent out-of-scope work
- Keep decomposition aligned with parent acceptance criteria
- Check for existing work items before creating duplicates

## Integration Points

- **forge-milestone-planner**: Creates parent feature issues with `milestone-feature` label
- **forge-project-milestone-tracker**: Monitors work item progress
- **forge-issue-triage-agent**: May triage work items (avoid double-labeling)
- **forge-stale-gardener**: Closes stale work items after 30 days

## Coordination

- Verify no existing work items reference this feature before decomposing
- Maintain link integrity (parent â†’ children, children â†’ parent)
- If feature has > 5 logical work items, prioritize most critical 5
- Add note if additional work items needed beyond the 5 created
