# Service Test Template
# Standard structure for Angular service tests with Jest/Jasmine

/**
 * Tests for {ServiceName}
 *
 * Service: {service_path}
 * Generated by Claude Code using skill:generate-jest-unit-tests
 *
 * Test Coverage:
 * {coverage_list}
 */

import { TestBed } from '@angular/core/testing';
{http_testing_imports}

import { {ServiceName} } from './{service_file}';
{service_imports}

describe('{ServiceName}', () => {
  let service: {ServiceName};
  {http_mock_declaration}
  {dependency_declarations}

  beforeEach(() => {
    {mock_setup}

    TestBed.configureTestingModule({
      imports: [{test_imports}],
      providers: [
        {ServiceName},
        {mock_providers}
      ]
    });

    service = TestBed.inject({ServiceName});
    {inject_mocks}
  });

  {http_verify}

  // ========================================================================
  // SERVICE CREATION
  // ========================================================================

  it('should_create_service', () => {
    expect(service).toBeTruthy();
  });

  // ========================================================================
  // HTTP GET OPERATIONS
  // ========================================================================

  {get_method_tests}

  // ========================================================================
  // HTTP POST OPERATIONS
  // ========================================================================

  {post_method_tests}

  // ========================================================================
  // HTTP PUT/PATCH OPERATIONS
  // ========================================================================

  {update_method_tests}

  // ========================================================================
  // HTTP DELETE OPERATIONS
  // ========================================================================

  {delete_method_tests}

  // ========================================================================
  // BUSINESS LOGIC
  // ========================================================================

  {logic_tests}

  // ========================================================================
  // ERROR HANDLING
  // ========================================================================

  {error_tests}

  // ========================================================================
  // CACHING / STATE MANAGEMENT
  // ========================================================================

  {cache_tests}
});

// ============================================================================
// JEST EXAMPLE WITH MOCKED HTTP
// ============================================================================

/**
 * Tests for UserService
 *
 * Service: src/app/services/user.service.ts
 * Generated by Claude Code using skill:generate-jest-unit-tests
 *
 * Test Coverage:
 * - getUser(id) - GET request
 * - updateUser(user) - PUT request
 * - deleteUser(id) - DELETE request
 * - Error handling for all methods
 */

import { TestBed } from '@angular/core/testing';
import { HttpClient } from '@angular/common/http';
import { of, throwError } from 'rxjs';

import { UserService } from './user.service';
import { User } from '../models/user.model';

describe('UserService (Jest)', () => {
  let service: UserService;
  let httpClient: jest.Mocked<HttpClient>;

  beforeEach(() => {
    httpClient = {
      get: jest.fn(),
      post: jest.fn(),
      put: jest.fn(),
      delete: jest.fn()
    } as any;

    TestBed.configureTestingModule({
      providers: [
        UserService,
        { provide: HttpClient, useValue: httpClient }
      ]
    });

    service = TestBed.inject(UserService);
  });

  // ========================================================================
  // SERVICE CREATION
  // ========================================================================

  it('should_create_service', () => {
    expect(service).toBeTruthy();
  });

  // ========================================================================
  // HTTP GET OPERATIONS
  // ========================================================================

  describe('getUser', () => {
    it('should_return_user_when_successful', (done) => {
      // Arrange
      const mockUser: User = { id: '123', name: 'John Doe', email: 'john@example.com' };
      httpClient.get.mockReturnValue(of(mockUser));

      // Act
      service.getUser('123').subscribe({
        next: (user) => {
          // Assert
          expect(user).toEqual(mockUser);
          expect(httpClient.get).toHaveBeenCalledWith('/api/users/123');
          done();
        }
      });
    });

    it('should_return_null_when_user_not_found', (done) => {
      // Arrange
      const error = { status: 404, message: 'Not Found' };
      httpClient.get.mockReturnValue(throwError(() => error));

      // Act
      service.getUser('999').subscribe({
        next: (user) => {
          // Assert
          expect(user).toBeNull();
          done();
        }
      });
    });

    it('should_propagate_error_when_server_error', (done) => {
      // Arrange
      const error = { status: 500, message: 'Internal Server Error' };
      httpClient.get.mockReturnValue(throwError(() => error));

      // Act
      service.getUser('123').subscribe({
        error: (err) => {
          // Assert
          expect(err.status).toBe(500);
          done();
        }
      });
    });
  });

  // ========================================================================
  // HTTP POST/PUT OPERATIONS
  // ========================================================================

  describe('updateUser', () => {
    it('should_update_user_when_valid_data', (done) => {
      // Arrange
      const mockUser: User = { id: '123', name: 'John Updated', email: 'john@example.com' };
      httpClient.put.mockReturnValue(of(mockUser));

      // Act
      service.updateUser(mockUser).subscribe({
        next: (user) => {
          // Assert
          expect(user).toEqual(mockUser);
          expect(httpClient.put).toHaveBeenCalledWith('/api/users/123', mockUser);
          done();
        }
      });
    });

    it('should_throw_error_when_user_id_missing', () => {
      // Arrange
      const invalidUser: User = { id: '', name: 'John', email: 'john@example.com' };

      // Act & Assert
      expect(() => service.updateUser(invalidUser)).toThrow('User ID is required');
    });

    it('should_propagate_validation_error', (done) => {
      // Arrange
      const mockUser: User = { id: '123', name: '', email: 'invalid-email' };
      const error = { status: 400, message: 'Validation failed' };
      httpClient.put.mockReturnValue(throwError(() => error));

      // Act
      service.updateUser(mockUser).subscribe({
        error: (err) => {
          // Assert
          expect(err.status).toBe(400);
          done();
        }
      });
    });
  });

  // ========================================================================
  // HTTP DELETE OPERATIONS
  // ========================================================================

  describe('deleteUser', () => {
    it('should_delete_user_when_successful', (done) => {
      // Arrange
      httpClient.delete.mockReturnValue(of(null));

      // Act
      service.deleteUser('123').subscribe({
        next: () => {
          // Assert
          expect(httpClient.delete).toHaveBeenCalledWith('/api/users/123');
          done();
        }
      });
    });

    it('should_propagate_error_when_delete_fails', (done) => {
      // Arrange
      const error = { status: 500, message: 'Delete failed' };
      httpClient.delete.mockReturnValue(throwError(() => error));

      // Act
      service.deleteUser('123').subscribe({
        error: (err) => {
          // Assert
          expect(err.status).toBe(500);
          done();
        }
      });
    });
  });
});

// ============================================================================
// JASMINE/KARMA EXAMPLE WITH HttpTestingController
// ============================================================================

import { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';

describe('UserService (Jasmine)', () => {
  let service: UserService;
  let httpMock: HttpTestingController;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [HttpClientTestingModule],
      providers: [UserService]
    });

    service = TestBed.inject(UserService);
    httpMock = TestBed.inject(HttpTestingController);
  });

  afterEach(() => {
    httpMock.verify();
  });

  it('should_create_service', () => {
    expect(service).toBeTruthy();
  });

  describe('getUser', () => {
    it('should_return_user_when_successful', () => {
      // Arrange
      const mockUser: User = { id: '123', name: 'John Doe', email: 'john@example.com' };

      // Act
      service.getUser('123').subscribe(user => {
        // Assert
        expect(user).toEqual(mockUser);
      });

      // Assert HTTP
      const req = httpMock.expectOne('/api/users/123');
      expect(req.request.method).toBe('GET');
      req.flush(mockUser);
    });

    it('should_handle_404_error', () => {
      // Act
      service.getUser('999').subscribe({
        next: (user) => expect(user).toBeNull(),
        error: fail
      });

      // Assert
      const req = httpMock.expectOne('/api/users/999');
      req.flush(null, { status: 404, statusText: 'Not Found' });
    });
  });

  describe('updateUser', () => {
    it('should_update_user_successfully', () => {
      // Arrange
      const mockUser: User = { id: '123', name: 'Updated', email: 'updated@example.com' };

      // Act
      service.updateUser(mockUser).subscribe(user => {
        expect(user).toEqual(mockUser);
      });

      // Assert
      const req = httpMock.expectOne('/api/users/123');
      expect(req.request.method).toBe('PUT');
      expect(req.request.body).toEqual(mockUser);
      req.flush(mockUser);
    });
  });
});

// ============================================================================
// SERVICE WITH OBSERVABLES AND RXJS
// ============================================================================

import { of, BehaviorSubject } from 'rxjs';
import { take, skip } from 'rxjs/operators';

describe('StateService (with RxJS)', () => {
  let service: StateService;

  beforeEach(() => {
    TestBed.configureTestingModule({
      providers: [StateService]
    });
    service = TestBed.inject(StateService);
  });

  describe('state management', () => {
    it('should_emit_initial_state', (done) => {
      // Act
      service.state$.subscribe(state => {
        // Assert
        expect(state).toEqual({ initialized: true });
        done();
      });
    });

    it('should_update_state_when_setState_called', (done) => {
      // Arrange
      const newState = { value: 'updated' };

      // Act
      service.setState(newState);

      // Assert
      service.state$.pipe(take(1)).subscribe(state => {
        expect(state).toEqual(newState);
        done();
      });
    });

    it('should_emit_multiple_state_changes', (done) => {
      // Arrange
      const states: any[] = [];

      // Act
      service.state$.pipe(take(3)).subscribe({
        next: (state) => states.push(state),
        complete: () => {
          // Assert
          expect(states.length).toBe(3);
          expect(states[0]).toEqual({ initialized: true });
          expect(states[1]).toEqual({ value: 'first' });
          expect(states[2]).toEqual({ value: 'second' });
          done();
        }
      });

      service.setState({ value: 'first' });
      service.setState({ value: 'second' });
    });
  });
});

// ============================================================================
// SERVICE WITH DEPENDENCIES
// ============================================================================

describe('OrderService (with dependencies)', () => {
  let service: OrderService;
  let mockUserService: jest.Mocked<UserService>;
  let mockCartService: jest.Mocked<CartService>;

  beforeEach(() => {
    mockUserService = {
      getCurrentUser: jest.fn()
    } as any;

    mockCartService = {
      getCart: jest.fn(),
      clearCart: jest.fn()
    } as any;

    TestBed.configureTestingModule({
      providers: [
        OrderService,
        { provide: UserService, useValue: mockUserService },
        { provide: CartService, useValue: mockCartService }
      ]
    });

    service = TestBed.inject(OrderService);
  });

  it('should_create_order_with_current_user', (done) => {
    // Arrange
    const mockUser = { id: '1', name: 'John' };
    const mockCart = { items: [{ id: '1', quantity: 2 }] };
    mockUserService.getCurrentUser.mockReturnValue(of(mockUser));
    mockCartService.getCart.mockReturnValue(of(mockCart));

    // Act
    service.createOrder().subscribe(order => {
      // Assert
      expect(order.userId).toBe('1');
      expect(order.items).toEqual(mockCart.items);
      expect(mockCartService.clearCart).toHaveBeenCalled();
      done();
    });
  });
});
