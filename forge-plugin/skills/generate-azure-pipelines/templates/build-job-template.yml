# Reusable Build Job Template
# Generated by Claude Code skill:generate-azure-pipelines

jobs:
  - job: BuildJob
    displayName: 'Build Application'
    steps:
      {{#USE_PYTHON}}
      - task: UsePythonVersion@0
        inputs:
          versionSpec: '{{VERSION}}'
        displayName: 'Use Python {{VERSION}}'

      - script: |
          {{#USE_POETRY}}
          pip install poetry
          poetry install
          {{/USE_POETRY}}
          {{#USE_PIP}}
          pip install -r requirements.txt
          {{/USE_PIP}}
        displayName: 'Install dependencies'

      - script: |
          {{#USE_POETRY}}
          poetry run pytest {{TEST_PATH}}
          {{/USE_POETRY}}
          {{#USE_PIP}}
          pytest {{TEST_PATH}}
          {{/USE_PIP}}
        displayName: 'Run tests'

      - script: |
          {{#USE_POETRY}}
          poetry build
          {{/USE_POETRY}}
          {{#USE_PIP}}
          python setup.py sdist bdist_wheel
          {{/USE_PIP}}
        displayName: 'Build package'
      {{/USE_PYTHON}}

      {{#USE_NODEJS}}
      - task: UseNodeVersion@0
        inputs:
          versionSpec: '{{VERSION}}'
        displayName: 'Use Node.js {{VERSION}}'

      - script: {{BUILD_TOOL}} {{INSTALL_COMMAND}}
        displayName: 'Install dependencies'

      - script: {{BUILD_TOOL}} run build
        displayName: 'Build application'

      - script: {{BUILD_TOOL}} test
        displayName: 'Run tests'
      {{/USE_NODEJS}}

      {{#USE_DOTNET}}
      - task: UseDotNet@2
        inputs:
          version: '{{VERSION}}'
        displayName: 'Use .NET {{VERSION}}'

      - script: dotnet restore
        displayName: 'Restore packages'

      - script: dotnet build --configuration $(buildConfiguration)
        displayName: 'Build application'

      - script: dotnet test --configuration $(buildConfiguration)
        displayName: 'Run tests'

      - script: dotnet publish --configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)
        displayName: 'Publish application'
      {{/USE_DOTNET}}

      - task: PublishBuildArtifacts@1
        inputs:
          pathToPublish: '$(Build.ArtifactStagingDirectory)'
          artifactName: '{{ARTIFACT_NAME}}'
          publishLocation: 'Container'
        displayName: 'Publish artifacts'
