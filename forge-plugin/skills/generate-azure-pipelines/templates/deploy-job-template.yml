# Reusable Deploy Job Template
# Generated by Claude Code skill:generate-azure-pipelines

parameters:
  - name: serviceConnection
    type: string
  - name: resourceGroup
    type: string
  - name: deploymentTarget
    type: string
  - name: artifactPath
    type: string

steps:
  {{#DEPLOY_TO_FUNCTION_APP}}
  - task: AzureCLI@2
    inputs:
      azureSubscription: '${{ parameters.serviceConnection }}'
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        az functionapp deployment source config-zip \
          --resource-group ${{ parameters.resourceGroup }} \
          --name {{FUNCTION_APP_NAME}} \
          --src ${{ parameters.artifactPath }}/{{PACKAGE_FILE}}
    displayName: 'Deploy to Azure Function App'
  {{/DEPLOY_TO_FUNCTION_APP}}

  {{#DEPLOY_TO_APP_SERVICE}}
  - task: AzureWebApp@1
    inputs:
      azureSubscription: '${{ parameters.serviceConnection }}'
      appType: 'webAppLinux'
      appName: '${{ parameters.deploymentTarget }}'
      package: '${{ parameters.artifactPath }}/{{PACKAGE_FILE}}'
    displayName: 'Deploy to Azure App Service'
  {{/DEPLOY_TO_APP_SERVICE}}

  {{#DEPLOY_TO_STATIC_WEB_APP}}
  - task: AzureStaticWebApp@0
    inputs:
      app_location: '{{APP_LOCATION}}'
      api_location: '{{API_LOCATION}}'
      output_location: '{{OUTPUT_LOCATION}}'
      azure_static_web_apps_api_token: '$(staticWebAppToken)'
    displayName: 'Deploy to Azure Static Web Apps'
  {{/DEPLOY_TO_STATIC_WEB_APP}}

  - script: |
      # Simple health check
      sleep 15
      echo "Deployment completed successfully"
    displayName: 'Post-deployment validation'
