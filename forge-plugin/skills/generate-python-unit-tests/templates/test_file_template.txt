# Test File Template
# This template provides the standard structure for a Python unit test file

"""
Tests for {module_name}

This module contains unit tests for {source_file_path}.
Generated by Claude Code using skill:generate-python-unit-tests

Test Coverage:
{coverage_list}
"""

# Standard library imports
{stdlib_imports}

# Third-party imports
{testing_framework_imports}
{mocking_imports}
{third_party_imports}

# Local imports
from {module_path} import {imported_items}


# ============================================================================
# FIXTURES AND HELPERS
# ============================================================================

{fixtures_section}


# ============================================================================
# TESTS: {ClassName or Module}
# ============================================================================

{test_classes_and_functions}


# ============================================================================
# INTEGRATION TESTS (if applicable)
# ============================================================================

{integration_tests_section}


# Template Variables Reference:
# ==============================
# {module_name}              - Name of the module being tested (e.g., "user_service")
# {source_file_path}         - Path to source file (e.g., "app/services/user_service.py")
# {coverage_list}            - Bulleted list of what's being tested
# {stdlib_imports}           - Standard library imports (e.g., from datetime import datetime)
# {testing_framework_imports}- pytest/unittest imports
# {mocking_imports}          - unittest.mock or pytest-mock imports
# {third_party_imports}      - Other third-party imports needed
# {module_path}              - Import path for module under test
# {imported_items}           - Classes/functions being tested
# {fixtures_section}         - Fixture definitions (pytest) or setUp methods (unittest)
# {test_classes_and_functions}- Main test implementations
# {integration_tests_section}- Integration tests if applicable

# ============================================================================
# PYTEST EXAMPLE
# ============================================================================

"""
Tests for user_service

This module contains unit tests for app/services/user_service.py.
Generated by Claude Code using skill:generate-python-unit-tests

Test Coverage:
- UserService.create_user (happy path, validation errors, duplicates)
- UserService.get_user (success, not found)
- UserService.update_user (success, validation, not found)
- UserService.delete_user (success, not found, cascade)
"""

# Standard library imports
from datetime import datetime
from unittest.mock import Mock, patch, call

# Third-party imports
import pytest

# Local imports
from app.services.user_service import UserService, UserExistsError, NotFoundError


# ============================================================================
# FIXTURES AND HELPERS
# ============================================================================

@pytest.fixture
def mock_db():
    """Mock database connection."""
    return Mock()


@pytest.fixture
def mock_email_service():
    """Mock email service."""
    return Mock()


@pytest.fixture
def user_service(mock_db, mock_email_service):
    """UserService instance with mocked dependencies."""
    return UserService(db=mock_db, email_service=mock_email_service)


@pytest.fixture
def sample_user_data():
    """Sample user data for testing."""
    return {
        "username": "testuser",
        "email": "test@example.com",
        "password": "SecurePass123"
    }


# ============================================================================
# TESTS: UserService.create_user
# ============================================================================

class TestCreateUser:
    """Tests for UserService.create_user method."""

    def test_should_create_user_when_valid_data_provided(
        self, user_service, mock_db, mock_email_service, sample_user_data
    ):
        """Test successful user creation with valid data."""
        # Arrange
        mock_db.user_exists.return_value = False
        mock_db.create_user.return_value = {"id": 1, **sample_user_data}

        # Act
        result = user_service.create_user(**sample_user_data)

        # Assert
        assert result["id"] == 1
        assert result["username"] == sample_user_data["username"]
        mock_db.create_user.assert_called_once()
        mock_email_service.send_welcome.assert_called_once_with(
            sample_user_data["email"]
        )

    def test_should_raise_error_when_username_already_exists(
        self, user_service, mock_db, sample_user_data
    ):
        """Test that duplicate username raises UserExistsError."""
        # Arrange
        mock_db.user_exists.return_value = True

        # Act & Assert
        with pytest.raises(UserExistsError, match="Username already exists"):
            user_service.create_user(**sample_user_data)

        mock_db.create_user.assert_not_called()

    @pytest.mark.parametrize("invalid_email", [
        "not-an-email",
        "missing-at-sign.com",
        "@no-local-part.com",
        "no-domain@.com",
    ])
    def test_should_raise_error_when_email_invalid(
        self, user_service, sample_user_data, invalid_email
    ):
        """Test that invalid email format raises ValidationError."""
        # Arrange
        sample_user_data["email"] = invalid_email

        # Act & Assert
        with pytest.raises(ValidationError, match="Invalid email format"):
            user_service.create_user(**sample_user_data)


# ============================================================================
# UNITTEST EXAMPLE
# ============================================================================

"""
Tests for calculator

This module contains unit tests for utils/calculator.py.
Generated by Claude Code using skill:generate-python-unit-tests

Test Coverage:
- add (basic addition, negative numbers, zero)
- subtract (basic subtraction, negative results)
- divide (basic division, division by zero)
"""

# Standard library imports
import unittest
from unittest.mock import Mock, patch

# Local imports
from utils.calculator import Calculator


# ============================================================================
# TESTS: Calculator
# ============================================================================

class TestCalculator(unittest.TestCase):
    """Tests for Calculator class."""

    def setUp(self):
        """Set up test fixtures before each test method."""
        self.calculator = Calculator()

    def tearDown(self):
        """Clean up after each test method."""
        self.calculator = None

    def test_add_should_return_sum_of_two_positive_numbers(self):
        """Test adding two positive numbers."""
        # Arrange
        a, b = 5, 3

        # Act
        result = self.calculator.add(a, b)

        # Assert
        self.assertEqual(result, 8)

    def test_add_should_handle_negative_numbers(self):
        """Test adding negative numbers."""
        # Arrange
        a, b = -5, -3

        # Act
        result = self.calculator.add(a, b)

        # Assert
        self.assertEqual(result, -8)

    def test_divide_should_raise_error_when_dividing_by_zero(self):
        """Test that division by zero raises ValueError."""
        # Arrange
        a, b = 10, 0

        # Act & Assert
        with self.assertRaises(ValueError) as context:
            self.calculator.divide(a, b)

        self.assertIn("Cannot divide by zero", str(context.exception))


if __name__ == '__main__':
    unittest.main()
