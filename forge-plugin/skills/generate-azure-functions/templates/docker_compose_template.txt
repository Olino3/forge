# Docker Compose configuration for {{PROJECT_NAME}} development environment
# Generated by Claude Code skill:generate-azure-functions

services:
{{#FUNCTION_APPS}}
  {{NAME}}:
    image: {{PROJECT_NAME}}-{{NAME}}-dev  # Built by Tilt
    ports:
      - "${{'{{NAME_UPPER}}_HOST_PORT:-{{PORT}}'}}:80"
    environment:
      - AzureWebJobsStorage=UseDevelopmentStorage=true;DevelopmentStorageProxyUri=http://azurite
      - AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=${{'{AZURITE_ACCOUNT_KEY}'}};BlobEndpoint=http://azurite:10000/devstoreaccount1;QueueEndpoint=http://azurite:10001/devstoreaccount1;TableEndpoint=http://azurite:10002/devstoreaccount1
      - FUNCTIONS_WORKER_RUNTIME={{RUNTIME}}
{{#CUSTOM_ENV_VARS}}
      - {{KEY}}=${{'{{{KEY}}:-{{DEFAULT}}}}'}}
{{/CUSTOM_ENV_VARS}}
    depends_on:
      - azurite
    volumes:
      - $HOME/.azure:/root/.azure

{{/FUNCTION_APPS}}
  azurite:
    image: {{PROJECT_NAME}}-azurite  # Built by Tilt
    ports:
      - "${AZURITE_BLOB_PORT:-10000}:10000"
      - "${AZURITE_QUEUE_PORT:-10001}:10001"
      - "${AZURITE_TABLE_PORT:-10002}:10002"
    environment:
      - AZURITE_ACCOUNTS=devstoreaccount1
      - AZURITE_ACCOUNT_KEY=${AZURITE_ACCOUNT_KEY}
    volumes:
      - azurite_data:/data
    command: azurite --blobHost 0.0.0.0 --queueHost 0.0.0.0 --tableHost 0.0.0.0 --location /data --debug /data/debug.log

volumes:
  azurite_data:
