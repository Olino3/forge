# Dockerfile for Azurite storage emulator
# Generated by Claude Code skill:generate-azure-functions

FROM mcr.microsoft.com/azure-storage/azurite:latest

# Install Python and dependencies for initialization
USER root
RUN apk add --no-cache python3 py3-pip netcat-openbsd

# Create virtual environment and install Azure Storage SDK
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"
RUN pip install --no-cache-dir \
    azure-storage-blob \
    azure-storage-queue \
    azure-data-tables

# Copy initialization script
COPY .docker/scripts/init_azurite.sh /init_azurite.sh
RUN chmod +x /init_azurite.sh

# Expose Azurite ports
EXPOSE 10000 10001 10002

# Start Azurite and run initialization
ENTRYPOINT ["/bin/sh", "-c", "azurite --blobHost 0.0.0.0 --queueHost 0.0.0.0 --tableHost 0.0.0.0 --location /data --debug /data/debug.log & sleep 5 && /init_azurite.sh && wait"]
