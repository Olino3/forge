# {CLI_TOOL} Failure Report: {COMMAND}

**Generated by**: Claude Code skill:test-cli-tools
**Date**: {DATE}
**Command**: `{FULL_COMMAND}`
**Severity**: {SEVERITY}

---

## Problem Summary

{BRIEF_DESCRIPTION}

---

## Reproduction Steps

1. {STEP_1}
2. {STEP_2}
3. {STEP_3}

```bash
# Exact command to reproduce
{REPRODUCTION_COMMAND}
```

---

## Expected Behavior

{EXPECTED_BEHAVIOR_DESCRIPTION}

**Expected Output**:
```
{EXPECTED_OUTPUT}
```

**Expected Exit Code**: {EXPECTED_EXIT_CODE}

---

## Actual Behavior

{ACTUAL_BEHAVIOR_DESCRIPTION}

**Actual Output**:
```
{ACTUAL_OUTPUT}
```

**Actual Exit Code**: {ACTUAL_EXIT_CODE}

---

## Error Output

### stdout
```
{STDOUT_OUTPUT}
```

### stderr
```
{STDERR_OUTPUT}
```

---

## Root Cause Analysis

{ROOT_CAUSE_DESCRIPTION}

### Source Code Location

**File**: `{SOURCE_FILE}`
**Line**: {LINE_NUMBER}
**Function/Method**: `{FUNCTION_NAME}`

### Problematic Code

```{LANGUAGE}
{CODE_SNIPPET}
```

### Error Flow

1. {ERROR_FLOW_STEP_1}
2. {ERROR_FLOW_STEP_2}
3. {ERROR_FLOW_STEP_3}

---

## Suggested Fix

### Approach

{FIX_APPROACH_DESCRIPTION}

### Code Changes

**File**: `{SOURCE_FILE}:{LINE_NUMBER}`

```diff
{DIFF_SHOWING_FIX}
```

### Alternative Solutions

{ALTERNATIVE_SOLUTIONS_IF_ANY}

---

## Impact Assessment

- **Severity**: {SEVERITY} (Critical / High / Medium / Low)
- **Affected Commands**: {AFFECTED_COMMANDS_LIST}
- **User Impact**: {USER_IMPACT_DESCRIPTION}
- **Workaround Available**: {YES_NO}

### Workaround

{WORKAROUND_DESCRIPTION_IF_AVAILABLE}

---

## Testing Recommendations

After applying fix, test:

1. {TEST_RECOMMENDATION_1}
2. {TEST_RECOMMENDATION_2}
3. {TEST_RECOMMENDATION_3}

```bash
# Test commands
{TEST_COMMANDS}
```

---

## Additional Notes

{ANY_ADDITIONAL_NOTES}

---

## Related Issues

{LINKS_TO_RELATED_ISSUES_OR_FAILURES}

---

**Example Template Usage**:

```markdown
# mygit Failure Report: commit

**Generated by**: Claude Code skill:test-cli-tools
**Date**: 2025-11-18 14:35:22
**Command**: `mygit commit`
**Severity**: High

---

## Problem Summary

The `mygit commit` command crashes with an AttributeError when attempting to commit without configuring user information. The error exposes Python internals to the user instead of providing a helpful message.

---

## Reproduction Steps

1. Initialize a new mygit repository: `mygit init`
2. Create and add a file: `echo "test" > file.txt && mygit add file.txt`
3. Attempt to commit: `mygit commit`

```bash
# Exact command to reproduce
mygit init
echo "test" > file.txt
mygit add file.txt
mygit commit
```

---

## Expected Behavior

The command should detect that user configuration is missing and display a helpful error message guiding the user to set up their identity.

**Expected Output**:
```
Error: Please configure your identity first

  mygit config user.name "Your Name"
  mygit config user.email "you@example.com"

Run 'mygit config --help' for more information.
```

**Expected Exit Code**: 1

---

## Actual Behavior

The command crashes with a Python AttributeError traceback, exposing internal implementation details.

**Actual Output**:
```
Traceback (most recent call last):
  File "/home/user/mygit", line 5, in <module>
    cli.main()
  File "/home/user/src/cli.py", line 89, in main
    commands.commit()
  File "/home/user/src/commands/commit.py", line 45, in commit
    author = f"{config.user.name} <{config.user.email}>"
AttributeError: 'NoneType' object has no attribute 'name'
```

**Actual Exit Code**: 1

---

## Error Output

### stdout
```
(empty)
```

### stderr
```
Traceback (most recent call last):
  File "/home/user/mygit", line 5, in <module>
    cli.main()
  File "/home/user/src/cli.py", line 89, in main
    commands.commit()
  File "/home/user/src/commands/commit.py", line 45, in commit
    author = f"{config.user.name} <{config.user.email}>"
AttributeError: 'NoneType' object has no attribute 'name'
```

---

## Root Cause Analysis

The commit command assumes that `config.user` exists and has `name` and `email` attributes. When these are not configured, `config.user` is `None`, causing an AttributeError when accessing `.name`.

### Source Code Location

**File**: `src/commands/commit.py`
**Line**: 45
**Function/Method**: `commit()`

### Problematic Code

```python
def commit():
    config = load_config()

    # BUG: No validation that config.user exists
    author = f"{config.user.name} <{config.user.email}>"

    commit_message = get_commit_message()
    create_commit(author, commit_message)
```

### Error Flow

1. `commit()` function called
2. `load_config()` returns config object with `user = None`
3. Code attempts to access `config.user.name`
4. AttributeError raised because `None` has no `name` attribute
5. Exception propagates to top level, showing traceback

---

## Suggested Fix

### Approach

Add validation after loading config to check if user information is configured. If not, display a helpful error message and exit gracefully.

### Code Changes

**File**: `src/commands/commit.py:45`

```diff
def commit():
    config = load_config()

+    # Validate user configuration
+    if not config.user or not config.user.name or not config.user.email:
+        print("Error: Please configure your identity first\n")
+        print("  mygit config user.name \"Your Name\"")
+        print("  mygit config user.email \"you@example.com\"\n")
+        print("Run 'mygit config --help' for more information.")
+        sys.exit(1)
+
    author = f"{config.user.name} <{config.user.email}>"

    commit_message = get_commit_message()
    create_commit(author, commit_message)
```

### Alternative Solutions

1. **Prompt for configuration interactively**:
   ```python
   if not config.user:
       name = input("Enter your name: ")
       email = input("Enter your email: ")
       set_config("user.name", name)
       set_config("user.email", email)
   ```

2. **Use default values**:
   ```python
   name = config.user.name if config.user else "Unknown"
   email = config.user.email if config.user else "unknown@localhost"
   ```
   (Not recommended - commits should have real identity)

---

## Impact Assessment

- **Severity**: High
- **Affected Commands**: `commit`, potentially other commands that use author info
- **User Impact**: New users will encounter confusing error on first commit attempt
- **Workaround Available**: Yes

### Workaround

Configure user information before committing:

```bash
mygit config user.name "Your Name"
mygit config user.email "your.email@example.com"
mygit commit
```

---

## Testing Recommendations

After applying fix, test:

1. **Unconfigured user**: Verify helpful error message shown
2. **Partially configured**: Test with only name or only email set
3. **Fully configured**: Verify commit succeeds normally
4. **Error message clarity**: Ensure message is helpful to new users

```bash
# Test commands
mygit commit  # Should show helpful error
mygit config user.name "Test User"
mygit commit  # Should still show error (email missing)
mygit config user.email "test@example.com"
mygit commit  # Should succeed (or prompt for commit message)
```

---

## Additional Notes

- This is a common "first-time user experience" issue
- Consider adding a setup wizard: `mygit setup`
- The error occurs in other commands too (e.g., `mygit rebase`)
- Good opportunity to add unit tests for config validation

---

## Related Issues

- Similar issue may exist in `src/commands/rebase.py`
- Related to general lack of config validation across commands
```
