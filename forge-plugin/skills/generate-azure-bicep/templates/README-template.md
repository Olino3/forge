# {{PROJECT_NAME}} Infrastructure

Generated by Claude Code `skill:generate-azure-bicep`

## Overview

This directory contains Bicep infrastructure as code using Azure Verified Modules (AVM).

## Structure

```
.azure/bicep/
├── main.bicep                       # Main template using AVM modules
├── main.development.bicepparams     # Development environment parameters
├── main.staging.bicepparams         # Staging environment parameters
├── main.production.bicepparams      # Production environment parameters
└── modules/                         # Custom wrapper modules (if any)
```

## Azure Resources

| Resource | AVM Module | Purpose |
|----------|------------|---------|
{{#RESOURCES}}
| {{NAME}} | {{AVM_MODULE}} | {{PURPOSE}} |
{{/RESOURCES}}

## Environments

### Development
- **Location**: {{DEV_LOCATION}}
- **SKU Strategy**: Cost-optimized (LRS storage, Basic plans)
- **Purpose**: Development and testing

### Staging
- **Location**: {{STAGING_LOCATION}}
- **SKU Strategy**: Production-like (LRS storage, Basic/Standard plans)
- **Purpose**: Pre-production validation

### Production
- **Location**: {{PROD_LOCATION}}
- **SKU Strategy**: High-availability (GRS storage, Premium plans)
- **Purpose**: Live production workload

## Deployment

### Prerequisites

- Azure CLI installed and authenticated
- Bicep CLI (comes with Azure CLI)
- Appropriate Azure permissions

### Deploy to Environment

```bash
# Development
az deployment {{DEPLOYMENT_SCOPE}} create \
  {{#SUBSCRIPTION_SCOPE}}
  --location {{DEV_LOCATION}} \
  {{/SUBSCRIPTION_SCOPE}}
  {{#RESOURCE_GROUP_SCOPE}}
  --resource-group {{DEV_RESOURCE_GROUP}} \
  {{/RESOURCE_GROUP_SCOPE}}
  --template-file .azure/bicep/main.bicep \
  --parameters .azure/bicep/main.development.bicepparams

# Staging
az deployment {{DEPLOYMENT_SCOPE}} create \
  {{#SUBSCRIPTION_SCOPE}}
  --location {{STAGING_LOCATION}} \
  {{/SUBSCRIPTION_SCOPE}}
  {{#RESOURCE_GROUP_SCOPE}}
  --resource-group {{STAGING_RESOURCE_GROUP}} \
  {{/RESOURCE_GROUP_SCOPE}}
  --template-file .azure/bicep/main.bicep \
  --parameters .azure/bicep/main.staging.bicepparams

# Production
az deployment {{DEPLOYMENT_SCOPE}} create \
  {{#SUBSCRIPTION_SCOPE}}
  --location {{PROD_LOCATION}} \
  {{/SUBSCRIPTION_SCOPE}}
  {{#RESOURCE_GROUP_SCOPE}}
  --resource-group {{PROD_RESOURCE_GROUP}} \
  {{/RESOURCE_GROUP_SCOPE}}
  --template-file .azure/bicep/main.bicep \
  --parameters .azure/bicep/main.production.bicepparams
```

### Validate Before Deploying

```bash
az deployment {{DEPLOYMENT_SCOPE}} validate \
  {{#SUBSCRIPTION_SCOPE}}
  --location {{DEV_LOCATION}} \
  {{/SUBSCRIPTION_SCOPE}}
  {{#RESOURCE_GROUP_SCOPE}}
  --resource-group {{DEV_RESOURCE_GROUP}} \
  {{/RESOURCE_GROUP_SCOPE}}
  --template-file .azure/bicep/main.bicep \
  --parameters .azure/bicep/main.development.bicepparams
```

### Preview Changes (What-If)

```bash
az deployment {{DEPLOYMENT_SCOPE}} what-if \
  {{#SUBSCRIPTION_SCOPE}}
  --location {{DEV_LOCATION}} \
  {{/SUBSCRIPTION_SCOPE}}
  {{#RESOURCE_GROUP_SCOPE}}
  --resource-group {{DEV_RESOURCE_GROUP}} \
  {{/RESOURCE_GROUP_SCOPE}}
  --template-file .azure/bicep/main.bicep \
  --parameters .azure/bicep/main.development.bicepparams
```

## Resource Naming Convention

| Resource Type | Pattern | Example |
|---------------|---------|---------|
{{#NAMING_PATTERNS}}
| {{RESOURCE_TYPE}} | {{PATTERN}} | {{EXAMPLE}} |
{{/NAMING_PATTERNS}}

## Updating Infrastructure

### Change Environment Parameters

Edit the appropriate `.bicepparams` file:
- `main.development.bicepparams` - Development settings
- `main.staging.bicepparams` - Staging settings
- `main.production.bicepparams` - Production settings

### Update AVM Module Versions

Check for new versions:
```bash
az bicep list-versions --module-path "br/public:avm/res/{{EXAMPLE_MODULE_PATH}}"
```

Update version in `main.bicep`:
```bicep
module resource 'br/public:avm/res/{{EXAMPLE_MODULE_PATH}}:NEW_VERSION' = {
  // ...
}
```

### Add New Resources

1. Add AVM module reference to `main.bicep`
2. Add parameters to all `.bicepparams` files
3. Update this README with new resource documentation

## Azure Verified Modules (AVM)

This infrastructure uses AVM for:
- **Pre-tested modules**: Microsoft-validated Bicep modules
- **Best practices**: Built-in security and reliability features
- **Consistency**: Standardized parameter names and patterns
- **Maintenance**: Regular updates from Microsoft

Learn more: https://azure.github.io/Azure-Verified-Modules/

## Troubleshooting

### Module Not Found
Ensure Bicep CLI is up to date:
```bash
az bicep upgrade
```

### Deployment Failures
Check deployment logs:
```bash
az deployment {{DEPLOYMENT_SCOPE}} show \
  {{#SUBSCRIPTION_SCOPE}}
  --name DEPLOYMENT_NAME \
  {{/SUBSCRIPTION_SCOPE}}
  {{#RESOURCE_GROUP_SCOPE}}
  --resource-group RESOURCE_GROUP_NAME \
  --name DEPLOYMENT_NAME \
  {{/RESOURCE_GROUP_SCOPE}}
  --query properties.error
```

### Resource Name Conflicts
Globally unique names (Storage, Key Vault) use `uniqueString()`. If conflicts occur, change the `resourcePrefix` parameter.

## Official Documentation

- [Azure Verified Modules](https://azure.github.io/Azure-Verified-Modules/)
- [Bicep Documentation](https://learn.microsoft.com/azure/azure-resource-manager/bicep/)
- [Azure Resource Naming](https://learn.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming)
